<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Special Question for You ‚ù§Ô∏è</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:ital,wght@1,500;1,700&display=swap"
        rel="stylesheet">
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function () {
            emailjs.init("lyr97Nk0vvOSTt9Un");
        })();
    </script>
    <style>
        /* CSS Styling */
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            background-color: #000;
            background-image: url('Background.jpg');
            /* Initial Background */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-image 1s ease-in-out;
        }

        /* Container for the centered content */
        #main-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }

        #video-container {
            position: relative;
            width: 90vw;
            height: 60vh;
            max-width: 1000px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            background: black;
            transition: opacity 1s ease;
            opacity: 0;
            /* Hidden initially */
        }

        #video-container.hidden {
            display: none;
            /* Hide when needed */
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            opacity: 0;
            transition: opacity 1s ease;
        }

        video.visible {
            opacity: 1;
        }

        /* --- Text Overlay --- */
        #proposal-text {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.8s ease;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            font-weight: 700;
            max-width: 90%;
            padding: 0 20px;
            /* Ensure it is visible above everything */
            z-index: 5;
        }

        #proposal-text.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Final Acceptance Image --- */
        #final-acceptance {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 20;
            /* Ensure background is transparent so we see body background */
            background: transparent;
        }

        #final-acceptance.visible {
            display: flex;
            animation: fadeIn 1s ease forwards;
        }

        #yes-image {
            max-width: 90%;
            max-height: 60vh;
            /* Leave room for text */
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
            object-fit: contain;
        }

        .final-text {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 20px;
            text-align: center;
            animation: bounceIn 1s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* --- Welcome / Entry Page --- */
        #welcome-box {
            /* The visible box itself - Now much lighter */
            background: rgba(255, 255, 255, 0.15);
            /* Light Translucent */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            text-align: center;
            max-width: 90%;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        #welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Make fully transparent so we see body bg */
            background: transparent;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            transition: opacity 1s ease-in-out;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            /* Improve text contrast */
        }

        #welcome-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .welcome-title {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-style: italic;
        }

        /* Loading Bar */
        #loading-container {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
            margin-top: 20px;
            margin-left: auto;
            margin-right: auto;
        }

        #loading-bar {
            width: 0%;
            height: 100%;
            background: #ff6b6b;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        /* Enter Button (Hidden until loaded) */
        #enter-btn {
            margin-top: 30px;
            padding: 12px 40px;
            font-size: 1.1rem;
            letter-spacing: 2px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            font-family: 'Montserrat', sans-serif;
        }

        #enter-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        #enter-btn.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        /* Debug and Fallback - Persistent */
        #debug-log {
            display: none;
            /* Hide for final polish unless needed */
            position: absolute;
            top: 10px;
            left: 10px;
            color: rgba(0, 0, 0, 0.7);
            font-family: monospace;
            font-size: 0.8rem;
            text-align: left;
            z-index: 10000;
            width: 90%;
            pointer-events: none;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px;
            border-radius: 4px;
        }

        #force-enter {
            margin-top: 20px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: underline;
            cursor: pointer;
            display: none;
        }

        #force-enter.visible {
            display: block;
        }

        /* --- Interaction Overlay --- */
        #overlay {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            pointer-events: none;
            z-index: 10;
        }

        #overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .btn {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            color: #d12e4f;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s ease, background 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-transform: uppercase;
            letter-spacing: 1px;
            outline: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: scale(1.05);
        }

        /* Yes Button Heartbeat */
        .yes-btn {
            animation: heartbeat 1.5s infinite;
            background: rgba(255, 60, 60, 0.8);
            color: white;
            border: none;
        }

        @keyframes heartbeat {
            0% {
                transform: scale(1);
            }

            14% {
                transform: scale(1.1);
            }

            28% {
                transform: scale(1);
            }

            42% {
                transform: scale(1.1);
            }

            70% {
                transform: scale(1);
            }
        }

        @media (max-width: 600px) {
            #video-container {
                width: 95vw;
                height: 50vh;
                /* Better for mobile portrait */
            }

            #proposal-text {
                font-size: 1.5rem;
                margin-bottom: 10px;
            }

            .final-text {
                font-size: 2rem;
            }

            .btn {
                padding: 12px 25px;
                font-size: 1rem;
            }

            .welcome-title {
                font-size: 2rem;
            }

            #welcome-box {
                padding: 20px;
            }
        }
    </style>
</head>

<body>

    <!-- Persistent Debug Log (Hidden unless critical) -->
    <div id="debug-log">Log: Initializing...<br></div>

    <!-- Welcome Screen / Loader -->
    <div id="welcome-screen">
        <div id="welcome-box">
            <h1 class="welcome-title">A Special Surprise...</h1>

            <div id="loading-container">
                <div id="loading-bar"></div>
            </div>

            <button id="enter-btn">Enter ‚ù§Ô∏è</button>
            <div id="force-enter">Loading stuck? Click here to enter anyway.</div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div id="main-container">

        <div id="proposal-text">PBEE my baby, my love, my favourite person .. Will you be my valentine??? ‚ù§Ô∏è‚ù§Ô∏è</div>

        <div id="video-container">
            <video id="mainVideo" playsinline>
                <source src="Propose.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>

            <!-- Overlay for interaction -->
            <div id="overlay">
                <button id="yesBtn" class="btn yes-btn">Yes! ‚ù§Ô∏è</button>
                <button id="noBtn" class="btn no-btn">No üíî</button>
            </div>
        </div>

        <!-- Post-Acceptance Flow (Hidden initially) -->
        <div id="final-acceptance">
            <div class="final-text">She said YES ü§ù</div>
            <img id="yes-image" src="YesPicture.jpeg" alt="She said YES!">
        </div>
    </div>

    <!-- Hidden Preloaders -->
    <div style="display:none;">
        <video id="preload-accept" preload="auto" muted>
            <source src="Accept.mp4" type="video/mp4">
        </video>
        <video id="preload-reject" preload="auto" muted>
            <source src="Reject.mp4" type="video/mp4">
        </video>
        <video id="preload-nofinal" preload="auto" muted>
            <source src="NoFinal.mp4" type="video/mp4">
        </video>
        <img src="YesPicture.jpeg" style="display:none;">
        <img src="proposeBackground.avif" style="display:none;">
    </div>

    <script>
        const video = document.getElementById('mainVideo');
        const overlay = document.getElementById('overlay');
        const yesBtn = document.getElementById('yesBtn');
        const noBtn = document.getElementById('noBtn');
        const proposalText = document.getElementById('proposal-text');

        const welcomeScreen = document.getElementById('welcome-screen');
        const enterBtn = document.getElementById('enter-btn');
        const loadingBar = document.getElementById('loading-bar');
        const loadingContainer = document.getElementById('loading-container');
        const debugLog = document.getElementById('debug-log');
        const forceEnter = document.getElementById('force-enter');

        const videoContainer = document.getElementById('video-container');
        const finalAcceptance = document.getElementById('final-acceptance');

        const preloadAccept = document.getElementById('preload-accept');
        const preloadReject = document.getElementById('preload-reject');
        const preloadNoFinal = document.getElementById('preload-nofinal');

        let isWaiting = false;
        let hasChosen = false;
        let videosLoaded = 0;
        const totalVideos = 4; // Added NoFinal

        // Rejection Logic State
        let rejectionCount = 0;

        // --- EmailJS Setup ---
        const SERVICE_ID = "service_o7knwam";
        const TEMPLATE_ID = "template_inwi3yf";

        function sendEmail(type) {
            let message = "";
            // To add multiple emails, separate them with commas. 
            // Example: "56divyansh@gmail.com, another@example.com"
            const recipient = "56divyansh@gmail.com, divtemp123@gmail.com, parikshitabhandari@gmail.com";

            if (type === 'yes') {
                message = `‚Äî‚Äì this is automated response‚Äî‚Äì\n\nThank you for accepting the proposal, ma‚Äôam.\n\nWe are pleased to inform you that my application for the position of Your Valentine has been carefully reviewed and officially approved. I sincerely appreciate the positive response and assure you that I will fulfill all duties associated with this prestigious role.\n\nThank you for granting me this wonderful opportunity. I look forward to a successful and joyful partnership.\n\nYours obediently (and happily),\nYour Valentine üíº‚ù§Ô∏è`;
            } else {
                message = `------ this is automated mail-----\nDukha dia na bache ka dil ü•∫\n`;
            }

            const params = {
                to_email: recipient,
                message: message,
            };

            emailjs.send(SERVICE_ID, TEMPLATE_ID, params)
                .then(function (response) {
                    log('SUCCESS! Email sent.');
                }, function (error) {
                    log('FAILED... ' + JSON.stringify(error));
                });
        }

        function log(msg) {
            if (debugLog.style.display !== 'none') {
                debugLog.innerHTML = msg;
            }
            console.log(msg);
        }

        // --- Preloading Logic ---

        function updateProgress() {
            videosLoaded++;
            log(`Loading... (${videosLoaded}/${totalVideos})`);
            const progress = (videosLoaded / totalVideos) * 100;
            loadingBar.style.width = `${progress}%`;

            if (videosLoaded === totalVideos) {
                // All loaded
                log("Ready.");
                setTimeout(() => {
                    loadingContainer.style.display = 'none';
                    enterBtn.classList.add('visible');
                    forceEnter.classList.remove('visible');
                }, 500);
            }
        }

        function checkVideoLoaded(vidElement, name) {
            vidElement.onerror = (e) => {
                log(`ERROR: ${name}`);
            };

            if (vidElement.readyState >= 3) {
                updateProgress();
            } else {
                const onLoaded = () => {
                    updateProgress();
                    vidElement.removeEventListener('canplaythrough', onLoaded);
                    vidElement.removeEventListener('loadeddata', onLoaded);
                };

                vidElement.addEventListener('canplaythrough', onLoaded, { once: true });
                vidElement.addEventListener('loadeddata', () => { }); // Fallback

                vidElement.load();
            }
        }

        checkVideoLoaded(video, "Propose.mp4");
        checkVideoLoaded(preloadAccept, "Accept.mp4");
        checkVideoLoaded(preloadReject, "Reject.mp4");
        checkVideoLoaded(preloadNoFinal, "NoFinal.mp4");

        setTimeout(() => {
            if (videosLoaded < totalVideos) {
                log("Slow connection...");
                forceEnter.classList.add('visible');
            }
        }, 5000);

        // --- Entry Interaction ---

        function enterSite() {
            // Hide welcome screen
            welcomeScreen.classList.add('fade-out');

            // Show video container
            videoContainer.style.opacity = '1'; /* Reveal container */
            video.classList.add('visible');
            video.style.opacity = '1';

            // Change Background
            document.body.style.backgroundImage = "url('proposeBackground.avif')";
            log("Background updated.");

            // Play main video UNMUTED (Sound on!)
            video.muted = false;
            video.volume = 1.0;
            const playPromise = video.play();

            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    log("");
                })
                    .catch(error => {
                        log(`Autoplay blocked: ${error}`);
                        video.muted = true;
                        video.play(); // Muted fallback
                    });
            }

            // Remove welcome screen from DOM after transition
            setTimeout(() => {
                welcomeScreen.style.display = 'none';
                // Show text overlay
                proposalText.classList.add('visible');
            }, 1000);
        }

        enterBtn.addEventListener('click', enterSite);
        forceEnter.addEventListener('click', () => {
            enterSite();
        });

        // --- Main Video Logic ---

        video.ontimeupdate = function () {
            if (hasChosen) return;

            // Updated Loop logic: Last 0.6 second
            if (video.duration > 0 && (video.duration - video.currentTime) <= 0.6) {
                if (!isWaiting) {
                    isWaiting = true;
                    showButtons();
                }

                // Seek back to loop (buffer of 0.3s)
                video.currentTime = Math.max(0, video.duration - 0.3); // Ensure not negative
                video.play();
            }
        };

        function showButtons() {
            overlay.classList.add('visible');
        }

        function hideButtons() {
            overlay.classList.remove('visible');
        }

        // --- Interactions ---

        yesBtn.addEventListener('click', () => {
            handleAccept();
        });

        noBtn.addEventListener('click', () => {
            rejectionCount++;
            handleRejectionStep();
        });

        function handleRejectionStep() {
            if (rejectionCount === 1) {
                proposalText.innerHTML = "Are you sure??";
                proposalText.style.animation = "shake 0.5s ease";
                setTimeout(() => proposalText.style.animation = "", 500);
            } else if (rejectionCount === 2) {
                proposalText.innerHTML = "Baby Bakchodi na karo ü•∫.. Please reconsider";
                proposalText.style.animation = "shake 0.5s ease";
                setTimeout(() => proposalText.style.animation = "", 500);
            } else {
                handleReject();
            }
        }

        function handleAccept() {
            if (hasChosen) return;
            hasChosen = true;
            isWaiting = false;
            hideButtons();

            // Hide Proposal Text
            proposalText.style.display = 'none';

            // Send Email
            sendEmail('yes');

            // Play Accept Video
            changeVideoSource('Accept.mp4');
            fireConfetti();

            // Listen for end of Accept Video
            video.onended = function () {
                // Video ended -> Show Image
                videoContainer.classList.add('hidden'); // Hide video
                videoContainer.style.display = 'none'; // Ensure gone

                finalAcceptance.classList.add('visible'); // Show image + text
                log("Finished.");
            };
        }

        function handleReject() {
            if (hasChosen) return;
            hasChosen = true;
            isWaiting = false;
            hideButtons();

            // Send Email
            sendEmail('no');

            proposalText.style.opacity = '0'; // Hide text

            changeVideoSource('Reject.mp4');

            // Listen for end of Reject Video
            video.onended = function () {
                // Reject Video Ended -> Play NoFinal
                changeVideoSource('NoFinal.mp4');
                video.onended = null;
            };
        }

        function changeVideoSource(src) {
            video.src = src;
            video.load();
            video.play().catch(e => log(`Play error: ${e}`));
        }

        // --- Confetti ---
        function fireConfetti() {
            const count = 200;
            const defaults = { origin: { y: 0.7 } };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }

            fire(0.25, { spread: 26, startVelocity: 55 });
            fire(0.2, { spread: 60 });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45 });
        }
    </script>
    <style>
        @keyframes shake {
            0% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            50% {
                transform: translateX(10px);
            }

            75% {
                transform: translateX(-10px);
            }

            100% {
                transform: translateX(0);
            }
        }
    </style>
</body>

</html>